<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Northfield V5 - NovaLife</title>

<!-- SUPABASE -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
/* === CSS STRICTEMENT IDENTIQUE À TON CODE === */
/* (rien modifié ici) */
</style>
</head>

<body>

<!-- === HTML STRICTEMENT IDENTIQUE À TON CODE === -->

<script>
/* ================= SUPABASE ================= */
const supabaseUrl = "https://owdolvoyequfcimwelgk.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im93ZG9sdm95ZXF1ZmNpbXdlbGdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5Mjg5NjUsImV4cCI6MjA4MjUwNDk2NX0.4JPgzL0MnE0YM9sCvxY9Tz7TwxrWfpSRlNBZynQf6Ko";

const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

/* ================= DONNÉES ================= */
const grades = [
    "Fondateur",
    "Co-Fondateur",
    "Responsable",
    "Responsable Staff",
    "Administrateur",
    "Modérateur",
    "Modérateur-Test"
];

let staffMembers = [];
let entreprises = [];

/* ================= ENTREPRISE ================= */

async function loadEntreprisesFromDB() {
    const { data } = await supabase.from("entreprises").select("*");
    entreprises = data || [];
    renderEntreprises();
}

function addEntreprise() {
    const nom = entrepriseNom.value.trim();
    const prenomPDG = entreprisePrenomPDG.value.trim();
    const nomPDG = entrepriseNomPDG.value.trim();
    const idTerrain = entrepriseIdTerrain.value.trim();
    const discord = entrepriseDiscord.value.trim();
    const phraseAccroche = entreprisePhraseAccroche.value.trim();

    if (!nom || !prenomPDG || !nomPDG || !idTerrain || !discord || !phraseAccroche) {
        alert("⚠️ Veuillez remplir tous les champs");
        return;
    }

    entreprises.push({
        nom,
        prenomPDG,
        nomPDG,
        idTerrain,
        discord,
        phraseAccroche
    });

    /* === SAUVEGARDE SUPABASE (AJOUT SEUL) === */
    supabase.from("entreprises").insert([{
        nom,
        prenom_pdg: prenomPDG,
        nom_pdg: nomPDG,
        id_terrain: idTerrain,
        discord,
        phrase_accroche: phraseAccroche
    }]);

    renderEntreprises();
}

async function deleteEntreprise(index) {
    const entreprise = entreprises[index];
    entreprises.splice(index, 1);
    renderEntreprises();

    /* === SUPPRESSION SUPABASE === */
    await supabase
        .from("entreprises")
        .delete()
        .match({
            nom: entreprise.nom,
            prenom_pdg: entreprise.prenomPDG,
            nom_pdg: entreprise.nomPDG
        });
}

/* ================= STAFF ================= */

async function loadStaffFromDB() {
    const { data } = await supabase.from("staff").select("*");
    staffMembers = (data || []).map(m => ({
        prenom: m.prenom,
        nom: m.nom,
        grade: m.grade,
        date: m.date_arrivee
    }));
    renderStaff();
}

function addStaff() {
    const prenom = staffPrenom.value.trim();
    const nom = staffNom.value.trim();
    const grade = staffGrade.value;
    const jour = staffJour.value;
    const mois = staffMois.value;
    const annee = staffAnnee.value;

    if (!prenom || !nom || !grade || !jour || !mois || !annee) {
        alert("⚠️ Champs manquants");
        return;
    }

    const dateStr = `${annee}-${mois.padStart(2,'0')}-${jour.padStart(2,'0')}`;

    staffMembers.push({
        prenom,
        nom,
        grade,
        date: dateStr
    });

    /* === SAUVEGARDE SUPABASE === */
    supabase.from("staff").insert([{
        prenom,
        nom,
        grade,
        date_arrivee: dateStr
    }]);

    renderStaff();
}

async function deleteStaff(index) {
    const staff = staffMembers[index];
    staffMembers.splice(index, 1);
    renderStaff();

    /* === SUPPRESSION SUPABASE === */
    await supabase
        .from("staff")
        .delete()
        .match({
            prenom: staff.prenom,
            nom: staff.nom,
            grade: staff.grade
        });
}

/* ================= INIT ================= */
loadEntreprisesFromDB();
loadStaffFromDB();
</script>

</body>
</html>
